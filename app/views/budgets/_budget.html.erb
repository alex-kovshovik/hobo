<% date = local_assigns.fetch(:date, @date) %>
<%= cache [budget.cache_key_with_date(date)] do %>
  <%= link_to budget_expenses_path(budget, date: date), id: dom_id(budget, date), class: "button is-light is-fullwidth", style: "height: auto; padding: 0.5rem 0.75rem;", data: { turbo: false } do %>
    <div class="is-flex is-flex-direction-column is-align-items-stretch" style="width: 100%;">
      <!-- Icon, Name, and Amount Row -->
      <div class="is-flex is-justify-content-space-between is-align-items-center mb-1">
        <div class="is-flex is-align-items-center">
          <span class="icon mr-2">
            <i class="<%= budget.icon %>"></i>
          </span>
          <span class="has-text-weight-medium"><%= budget.name %></span>
        </div>
        <div class="is-flex is-flex-direction-column is-align-items-flex-end" style="line-height: 1.2;">
          <span class="has-text-weight-medium"><%= number_to_currency(budget.total_spent, precision: 0) %></span>
          <span style="font-size: 0.65rem; color: #9ca3af;">of <%= number_to_currency(budget.amount, precision: 0) %></span>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="is-relative" style="height: 0.75rem;">
        <progress class="progress is-small mb-0" value="<%= budget.total_spent %>" max="<%= budget.amount %>" style="--bulma-progress-value-background-color: <%= budget.progress_bar_color %>;"><%= budget.percent_spent %>%</progress>
        <% if budget.percent_of_month < 100 %>
          <div style="position: absolute; top: 0; bottom: 0; width: 2px; left: <%= budget.percent_of_month %>%; transform: translateX(-50%); background-color: <%= budget.progress_marker_color %>;"></div>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>